/* JQUERY TRIANGLE TRAIL PLUGIN https://github.com/andysellick/triangles */
!function(t,e){var a=function(t,a){this.elem=t,this.$elem=e(t),this.options=a};a.prototype={init:function(){var a=this;this.settings=e.extend({triangleWidth:28,triangleHeight:28,colour:"38,60,73",surrogate:""},this.defaults,this.options),this.canvas,this.canvasw,this.canvash,this.cxt,this.canvasok=0,this.trianglestore=[],this.loop,this.plusx,this.plusy,this.startx="unset",this.starty="unset",this.triangles={general:{initialise:function(){a.canvas=document.getElementById(a.$elem.attr("id")),a.triangles.general.initCanvasSize(),a.canvasok=a.triangles.general.initCanvas()},initCanvasSize:function(){var t=a.$elem.offset();a.plusx=t.left,a.plusy=t.top;var e=a.$elem.parent();a.canvas.width=e.outerWidth(),a.canvas.height=e.outerHeight(),a.canvasw=a.canvas.width,a.canvash=a.canvas.height,"unset"==a.startx&&(a.startx=a.$elem.width()/2,a.starty=a.$elem.height()/2)},initCanvas:function(){return a.canvas.getContext?(a.cxt=a.canvas.getContext("2d"),1):void 0},clearCanvas:function(){a.cxt.clearRect(0,0,a.canvasw,a.canvash)}},draw:{callDraw:function(t){a.triangles.draw.createTriangles(t.pageX-a.plusx,t.pageY-a.plusy,1),a.triangles.draw.createTriangles(t.pageX-a.plusx+a.settings.triangleWidth/2,t.pageY-a.plusy+a.settings.triangleWidth/2,.5),a.canvasok&&(a.loop||a.triangles.draw.drawLoop())},createTriangles:function(t,e,n){var i=a.settings.triangleWidth,r=a.settings.triangleHeight,s=Math.floor(t/i);s*=i;var l=Math.floor(e/r);l*=r;var o,g=t-s,c=e-l;o=(i+r)/2>g+c?[[s,l],[s+i,l],[s,l+r],n]:[[s+i,l+r],[s+i,l],[s,l+r],n],a.triangles.draw.checkIfExists(o)&&a.trianglestore.push(o)},drawTriangle:function(t,e,n,i){a.cxt.fillStyle="rgba("+a.settings.colour+","+i+")",a.cxt.beginPath(),a.cxt.moveTo(t[0],t[1]),a.cxt.lineTo(e[0],e[1]),a.cxt.lineTo(n[0],n[1]),a.cxt.closePath(),a.cxt.fill()},drawLoop:function(){a.triangles.general.clearCanvas();for(var t=0;t<a.trianglestore.length;t++){var e=a.trianglestore[t];a.trianglestore[t][3]<.1?a.trianglestore.splice(t,1):(a.triangles.draw.drawTriangle(e[0],e[1],e[2],e[3]),1==a.trianglestore[t][3]&&(a.trianglestore[t][3]=.7),a.trianglestore[t][3]-=.1)}a.loop=a.trianglestore.length?setTimeout(a.triangles.draw.drawLoop,60):0},checkIfExists:function(t){for(var e=0;e<a.trianglestore.length;e++)if(a.trianglestore[e].equals(t))return!1;return!0}},mobile:{addListeners:function(){t.DeviceOrientationEvent?t.addEventListener("deviceorientation",function(){a.triangles.mobile.tilt([event.beta,event.gamma])},!0):t.DeviceMotionEvent?t.addEventListener("devicemotion",function(){a.triangles.mobile.tilt([2*event.acceleration.x,2*event.acceleration.y])},!0):t.addEventListener("MozOrientation",function(){a.triangles.mobile.tilt([50*orientation.x,50*orientation.y])},!0)},tilt:function(e){var n=e[0],i=e[1];switch(t.orientation){case 0:n=-e[1],i=e[0];break;case 90:n=-n,i=-i;break;case 180:n=e[1],i=-e[0]}var r=0,s=.6,l=.6;(n>s||-s>n)&&(a.startx=Math.min(a.$elem.width()-a.settings.triangleWidth,Math.max(a.startx-n,0)),r=1),(i>l||-l>i)&&(a.starty=Math.max(0,Math.min(a.starty+i,a.$elem.height()-a.settings.triangleHeight)),r=1),r&&(a.triangles.draw.createTriangles(a.startx,a.starty,1),a.triangles.draw.createTriangles(a.startx+a.settings.triangleWidth/2,a.starty+a.settings.triangleWidth/2,.5),a.canvasok&&(a.loop||a.triangles.draw.drawLoop()))}}},Array.prototype.equals=function(t){for(var e=0,a=this.length;a>e;e++)if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].equals(t[e]))return!1}else if(this[e]!=t[e])return!1;return!0},a.triangles.general.initialise(),"ontouchstart"in document.documentElement&&a.triangles.mobile.addListeners(),e(t).on("resize",function(){a.triangles.general.initCanvasSize()}),this.$elem.mousemove(function(t){a.triangles.draw.callDraw(t)}),e(a.settings.surrogate).mousemove(function(t){a.triangles.draw.callDraw(t)})}},e.fn.triangles=function(t){return this.each(function(){new a(this,t).init()})},t.Plugin=a}(window,jQuery);