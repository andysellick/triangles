/* JQUERY TRIANGLE TRAIL PLUGIN https://github.com/andysellick/triangles */
!function(t,e){var i=function(t,i){this.elem=t,this.$elem=e(t),this.options=i};i.prototype={init:function(){var i=this;this.settings=e.extend({triangleWidth:28,triangleHeight:28,colour:"38,60,73",surrogate:""},this.defaults,this.options),this.canvas,this.cxt,this.trianglestore=[],this.loop,this.plusx,this.plusy,this.startx="unset",this.starty="unset",this.triangles={general:{initialise:function(){i.canvas=document.getElementById(i.$elem.attr("id")),i.triangles.general.initCanvasSize(),i.triangles.general.initCanvas()&&i.triangles.draw.drawLoop()},initCanvasSize:function(){var t=i.$elem.offset();i.plusx=t.left,i.plusy=t.top;var e=i.$elem.parent();i.canvas.width=e.width(),i.canvas.height=e.height(),"unset"==i.startx&&(i.startx=i.$elem.width()/2,i.starty=i.$elem.height()/2)},initCanvas:function(){return i.canvas.getContext?(i.cxt=i.canvas.getContext("2d"),1):void 0},clearCanvas:function(){i.cxt.clearRect(0,0,i.canvas.width,i.canvas.height);var t=i.canvas.width;i.canvas.width=1,i.canvas.width=t}},draw:{callDraw:function(t){i.triangles.draw.createTriangles(t.pageX-i.plusx,t.pageY-i.plusy,1),i.triangles.draw.createTriangles(t.pageX-i.plusx+i.settings.triangleWidth/2,t.pageY-i.plusy+i.settings.triangleWidth/2,.5)},createTriangles:function(t,e,n){var a=i.settings.triangleWidth,r=i.settings.triangleHeight,s=Math.floor(t/a);s*=a;var l=Math.floor(e/r);l*=r;var o,g=t-s,c=e-l;o=(a+r)/2>g+c?[[s,l],[s+a,l],[s,l+r],n]:[[s+a,l+r],[s+a,l],[s,l+r],n],i.triangles.draw.checkIfExists(o)&&i.trianglestore.push(o)},drawTriangle:function(t,e,n,a){i.cxt.fillStyle="rgba("+i.settings.colour+","+a+")",i.cxt.beginPath(),i.cxt.moveTo(t[0],t[1]),i.cxt.lineTo(e[0],e[1]),i.cxt.lineTo(n[0],n[1]),i.cxt.closePath(),i.cxt.fill()},drawLoop:function(){i.triangles.general.clearCanvas();for(var t=0;t<i.trianglestore.length;t++){var e=i.trianglestore[t];i.trianglestore[t][3]<.1?i.trianglestore.splice(t,1):(i.triangles.draw.drawTriangle(e[0],e[1],e[2],e[3]),1==i.trianglestore[t][3]&&(i.trianglestore[t][3]=.7),i.trianglestore[t][3]-=.1)}i.loop=setTimeout(i.triangles.draw.drawLoop,60)},checkIfExists:function(t){for(var e=0;e<i.trianglestore.length;e++)if(i.trianglestore[e].equals(t))return!1;return!0}},mobile:{addListeners:function(){t.DeviceOrientationEvent?t.addEventListener("deviceorientation",function(){i.triangles.mobile.tilt([event.beta,event.gamma])},!0):t.DeviceMotionEvent?t.addEventListener("devicemotion",function(){i.triangles.mobile.tilt([2*event.acceleration.x,2*event.acceleration.y])},!0):t.addEventListener("MozOrientation",function(){i.triangles.mobile.tilt([50*orientation.x,50*orientation.y])},!0)},tilt:function(e){var n=e[0],a=e[1];switch(t.orientation){case 0:n=-e[1],a=e[0];break;case 90:n=-n,a=-a;break;case 180:n=e[1],a=-e[0]}var r=0,s=.6,l=.6;(n>s||-s>n)&&(i.startx=Math.min(i.$elem.width()-i.settings.triangleWidth,Math.max(i.startx-n,0)),r=1),(a>l||-l>a)&&(i.starty=Math.max(0,Math.min(i.starty+a,i.$elem.height()-i.settings.triangleHeight)),r=1),r&&(i.triangles.draw.createTriangles(i.startx,i.starty,1),i.triangles.draw.createTriangles(i.startx+i.settings.triangleWidth/2,i.starty+i.settings.triangleWidth/2,.5))}}},Array.prototype.equals=function(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var e=0,i=this.length;i>e;e++)if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].equals(t[e]))return!1}else if(this[e]!=t[e])return!1;return!0},i.triangles.general.initialise(),"ontouchstart"in document.documentElement&&i.triangles.mobile.addListeners(),e(t).on("resize",function(){i.triangles.general.initCanvasSize()}),this.$elem.mousemove(function(t){i.triangles.draw.callDraw(t)}),e(i.settings.surrogate).mousemove(function(t){i.triangles.draw.callDraw(t)})}},e.fn.triangles=function(t){return this.each(function(){new i(this,t).init()})},t.Plugin=i}(window,jQuery);